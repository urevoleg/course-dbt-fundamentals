# Deeper Jinja

![deeper.jpeg](img%2Fdeeper.jpeg)

В этой части тебя ждут макросы и расширения.

## Macros

Macros (макроопределения) - кусочки кода, которые можно вызывать, чтобы избежать однотипных повторяемых вызовов, так сказать будешь следовать 
принципу [DRY](https://ru.wikipedia.org/wiki/Don’t_repeat_yourself) (ты сможешь гордо сказать об этом на собесе =))

![dry.png](img%2Fdry.png)


Базовый синтаксис:

```sql
{% macro macro_name(*args, **kwargs)%}

{% endmacro %}
```

Ключевое слово `macro` +  набор аргументов, прямо как в Python - всё как ты любишь.

Использовать в других шаблона так же как и любой параметр `{{macro_name()}}`

Используем наши навыки: напишем макрос, который выводит текущую дату, в качестве параметра зададим имя поля с датой

```sql
{% macro current_datetime(column_name)%}
SELECT now() as {{column_name}};
{% endmacro %}

{{ current_datetime('dt') }}
```

Результат:

```sql
SELECT now() as dt;
```

Как создавать макросы и вызывать их ты умеешь, теперь нужно усилить свою мощь: писать каждый раз макрос ради его написания - плохая практика и противоречит DRY.
Далее познакомимся с тем как расширять модели макросами и решим задачу:

**Задача:**

Чтобы не писать каждый раз обработку нашего запроса (помнишь, там много предобработки, типы, строки и прочее) необходимо:
- составить запрос с предобработкой (базово выделить основную страну, основной жанр, привести год к целому числу, выделить рейтинг IMDb и и привести его к десятичному числу)
- 